pipeline {
    agent any

    stages {
        stage('Test') {
            steps {
                script {
                    deployToAppService('test')
                }
            }
        }

        stage('Stage') {
            steps {
                script {
                    deployToAppService('stage')
                }
            }
        }

        stage('Prod') {
            steps {
                script {
                    deployToAppService('prod')
                }
            }
        }
    }
}

def deployToAppService(env) {
    def appName = "<your-app-name>"
    def resourceGroup = "sreeui_group"
    def servicePlan = "carui"
    def appServiceName = appName + "sreeui" + env

    withCredentials([azureServicePrincipal("<your-azure-credentials-ID>")]) {
        sh "az login --service-principal --saikrishnagorijavolu@outlook.com \$AZURE_CLIENT_ID --$@!Krish@2889 \$AZURE_CLIENT_SECRET --tenant \$AZURE_TENANT_ID"
        sh "git clone https://github.com/<sreenivas1210>/<https://github.com/sreenivas1210/carui.git>.git"
        sh "az webapp deployment source config-zip --resource-group $resourceGroup --name $appServiceName --src <https://github.com/sreenivas1210/carui.git>/.zip"
        sh "az webapp restart --resource-group $resourceGroup --name $appServiceName"
    }
}
